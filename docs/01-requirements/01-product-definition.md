# 01 产品定义与范围 (Product Definition)

## 1. 背景与目标
Easy-Station 旨在解决现代分布式系统中 Agent 管理复杂、环境分散、操作割裂的问题。通过提供一套统一的、目标驱动（Goal-Driven）的运维平台，帮助运维人员（Ops）与开发人员（Dev）在统一的界面下高效完成环境管理、主机纳管、Agent 资源配置、打包部署以及运行时的状态观测与命令执行。

**核心目标**：
1.  **统一管理**：在一个平台纳管多环境（开发、测试、生产）、多主机与多 Agent。
2.  **目标驱动交互**：摒弃传统的“资源列表”式导航，采用“我要做什么”（如“部署 Agent”、“查看日志”）的任务导向设计，降低使用门槛。
3.  **全生命周期覆盖**：覆盖 Agent 从资源配置、打包、部署到运行监控、命令执行的全生命周期。

## 2. 系统边界
本系统明确划分为三个内部子系统与一个外部依赖：

1.  **Server (服务端)**：
    *   系统的核心大脑，负责业务逻辑处理、数据持久化、权限控制、任务编排与状态聚合。
    *   管理环境、主机、Agent 定义及其相互关系。
    *   **注意**：Server 不直接与 Agent 建立网络连接，而是通过 Proxy 进行通信。

2.  **Agent (代理程序)**：
    *   **Host Agent (Runner)**：
        *   **定位**：需**手动部署**至目标主机并启动，作为主机的“基座”。
        *   **通信核心**：启动后主动连接 Proxy，建立与 Server 的通信通道。
        *   **调度中心**：负责接收 Server 下发的 Agent 包与指令，并调度执行。
    *   **Agent (插件 / 功能单元)**：
        *   具体的职能插件或脚本（如文件传输、数据库备份）。
        *   通过 Host Agent 建立的通道下发并由其调用执行。

3.  **Frontend (前端)**：
    *   面向用户的操作界面，提供目标面板、向导式操作流与可视化反馈。
    *   通过 RESTful API 与 Server 交互。

4.  **Proxy (主机网关 - 外部依赖)**：
    *   **非本系统实现范围**，作为第三方中间件存在。
    *   职责：负责 Server 与 Host Agent 之间的网络连通、消息转发与长连接维护。
    *   本系统仅定义与 Proxy 的交互契约与异常处理逻辑。

## 3. 核心概念与术语

### 3.1 基础设施实体
*   **Environment (环境)**：
    *   逻辑隔离域，用于区分不同的部署阶段或网络区域（如 `dev`, `staging`, `prod`）。
    *   作为资源组织和权限控制的顶层容器。
*   **Host (主机)**：
    *   物理机、虚拟机或容器节点的逻辑映射。
    *   必须隶属于某一个特定的环境。
    *   **核心载体**：每个纳管的主机运行一个 Host Agent (Runner) 进行通信与管理。

### 3.2 Agent 相关实体
*   **AgentTemplate (Agent 模板)**：
    *   定义具体的业务 Agent 的蓝图（如 Nginx 管理插件、Java 应用监控）。
    *   包含资源来源配置（Git/Docker）与预定义命令。
*   **AgentInstance (Agent 实例)**：
    *   由模板生成的、运行在特定主机上的具体实体。
    *   **依赖关系**：依赖 Host Agent 进行部署、启动与管理。
*   **Binding (绑定关系)**：
    *   描述 AgentInstance 与 Environment/Host 的关联。

### 3.3 动作与状态
*   **Resource Source (资源来源)**：
    *   定义代码或二进制包的获取方式。
*   **Deployment (部署)**：
    *   Server 通过 Host Agent 通道，将打包好的 Agent 投放到目标主机的过程。
*   **Command (命令)**：
    *   运维人员下发、由 Host Agent 调度执行的操作指令。

## 4. 用户角色与权限 (RBAC)
系统基于角色的访问控制（RBAC）模型，预定义以下角色：

*   **Admin (系统管理员)**：
    *   拥有系统所有权限。
    *   负责全局配置、用户管理、审计日志查看。

*   **Ops (运维人员)**：
    *   侧重于基础设施与运行维护。
    *   **主机纳管**：负责 Host Agent 的手动部署与接入。
    *   **实例管理**：在主机上添加与部署 Agent 实例。

*   **Dev (开发人员)**：
    *   侧重于 Agent 的功能开发与定义。
    *   **模板定义**：创建 Agent 模板，配置资源来源。
    *   **触发构建**：触发打包流程。

*   **Viewer (只读用户)**：
    *   仅拥有查看权限。
