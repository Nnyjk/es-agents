# 03 用户交互流程 (User Interaction Logic)

## 1. 交互设计理念
系统交互设计回归资源管理本质，以**基础设施层级**（环境 -> 主机 -> Agent）为核心导航路线，辅以**模板与资源管理**。

*   **层级化导航**：清晰展示 环境 -> 主机 -> Agent 的包含关系。
*   **标准化操作**：所有 Agent 实例的生命周期操作（打包/部署/命令）均在主机视图下进行。
*   **向导辅助**：保留关键流程（如部署）的向导式体验，但入口内聚于资源视图中。

## 2. 核心导航与页面结构

### 2.1 基础设施视图 (Infrastructure View)
这是运维人员（Ops）最常驻的视图。

1.  **环境列表**：
    *   展示所有环境卡片（Dev, Prod）。
    *   点击进入环境详情（即主机列表）。
2.  **主机列表**：
    *   展示该环境下的所有主机。
    *   提供“新增主机”入口。
    *   点击进入主机详情。
3.  **主机详情 (Host Detail)**：
    *   **Agent 实例列表区**：
        *   展示该主机上运行的所有 Agent。
        *   **操作入口**：“添加 Agent”（基于模板）。
        *   **单实例操作**：对某个 Agent 进行打包、部署、执行命令、查看日志。

### 2.2 模板与资源视图 (Template & Resources View)
这是开发人员（Dev）维护 Agent 定义的地方。

1.  **Agent 模板列表**：
    *   展示所有 Agent 的定义。
    *   提供“新建模板”入口。
2.  **模板详情与配置**：
    *   **资源配置**：配置 Git/Docker 等来源。
    *   **命令定义**：维护该 Agent 支持的运维命令集合（脚本、参数）。
3.  **资源管理**：
    *   统一管理上传的文件、连接凭证等。

## 3. 关键任务流程

### 3.1 部署新 Agent (Host-Centric Flow)
1.  **进入上下文**：用户导航至 目标环境 -> 目标主机。
2.  **触发添加**：点击“添加 Agent”按钮。
3.  **选择模板**：
    *   系统弹出模态框/抽屉，列出可用 Agent 模板。
    *   用户选择一个模板（如 `Nginx-Agent`）。
4.  **生成与配置**：
    *   系统生成 Agent 实例。
    *   (可选) 用户微调实例级配置。
5.  **生命周期动作**：
    *   实例出现在列表中，状态为“未准备”。
    *   用户点击“准备/打包” -> “部署”。
    *   系统执行部署流水线，并在当前行或详情页展示进度。

### 3.2 执行运维命令
1.  **进入上下文**：用户导航至 目标主机 -> 目标 Agent 实例。
2.  **触发命令**：点击“执行命令”或“运维”按钮。
3.  **选择命令**：
    *   系统展示该实例对应模板中定义的**命令列表**（如 `Backup DB`, `Reload Config`）。
    *   用户选择指令。
4.  **执行与反馈**：
    *   用户确认参数并发送。
    *   系统在侧边栏或弹窗中展示实时执行日志与最终结果。

### 3.3 维护 Agent 模板
1.  **新建/编辑模板**：开发人员在模板库中操作。
2.  **定义命令**：
    *   在模板中新增一个命令 `Restart`。
    *   编写 Shell 脚本内容。
    *   保存。
3.  **生效**：所有基于该模板生成的实例，在下次操作时即可看到 `Restart` 选项（视版本策略而定）。

## 4. 全局交互规则
*   **状态可见性**：主机列表与 Agent 列表需实时（或高频轮询）反映在线/离线状态。
*   **操作反馈**：关键操作（部署、命令）需有明确的进度反馈与结果通知。
